<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - RSI & VWAP Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 95%; margin: auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 10px; }
        .alert { color: red; font-weight: bold; }
        .error-message { color: red; font-weight: bold; margin-top: 20px; }
        .input-container { margin: 20px; }
    </style>
</head>
<body>
    <h1>Trading Dashboard - RSI & VWAP Tracker</h1>
    
    <div class="input-container">
        <input type="text" id="stock-input" placeholder="Enter Stock Symbol">
        <button onclick="addStock()">Add Stock</button>
    </div>
    
    <h2>Stock Scanner (RSI < 30 or RSI > 70)</h2>
    <table>
        <tr>
            <th>Symbol</th>
            <th>Price</th>
            <th>RSI</th>
            <th>VWAP</th>
            <th>Change %</th>
            <th>Volume</th>
            <th>52-Week High</th>
            <th>52-Week Low</th>
            <th>Market Cap</th>
            <th>Alert</th>
            <th>Remove</th>
        </tr>
        <tbody id="stock-table"></tbody>
    </table>
    
    <h2>Live Chart - Stock Price & VWAP</h2>
    <canvas id="stockChart" width="800" height="500"></canvas>
    <p id="error-message" class="error-message"></p>
    
    <script>
        let symbols = ['AAPL', 'TSLA', 'NVDA', 'AMZN', 'SPY', 'GOOGL', 'MSFT', 'META', 'AMD', 'NFLX', 'BABA', 'SHOP'];
        const apiKey = 'YOUR_API_KEY_HERE';
        
        function addStock() {
            const stockInput = document.getElementById("stock-input").value.toUpperCase();
            if (stockInput && !symbols.includes(stockInput)) {
                symbols.push(stockInput);
                fetchStockData();
                document.getElementById("stock-input").value = "";
            }
        }
        
        function removeStock(symbol) {
            symbols = symbols.filter(s => s !== symbol);
            fetchStockData();
        }
        
        function getTradeAlert(data) {
            let alertMessage = "No Signal";
            let price = parseFloat(data["05. price"] || 0);
            let rsi = parseFloat(data["RSI"] || 50);
            let vwap = parseFloat(data["VWAP"] || price);
            let relVolume = parseFloat(data["RelVolume"] || 1);

            if (rsi < 30 && price > vwap && relVolume > 1.5) {
                alertMessage = "ðŸ”µ Buy Signal";
            } else if (rsi > 70 || price < vwap) {
                alertMessage = "ðŸ”´ Sell Signal";
            }
            
            if (alertMessage !== "No Signal") {
                alert(`ðŸš€ Trade Alert for ${data["01. symbol"]}: ${alertMessage}`);
                sendWhatsAppAlert(data["01. symbol"], alertMessage);
            }
            return alertMessage;
        }
        
        async function sendWhatsAppAlert(symbol, message) {
            const phoneNumber = "YOUR_WHATSAPP_NUMBER";
            const encodedMessage = encodeURIComponent(`Trade Alert for ${symbol}: ${message}`);
            window.open(`https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`, '_blank');
        }
        
        async function fetchStockData() {
            const tableBody = document.getElementById("stock-table");
            const errorMessage = document.getElementById("error-message");
            tableBody.innerHTML = "";
            errorMessage.textContent = "";
            
            for (let symbol of symbols) {
                try {
                    let response = await axios.get(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${apiKey}`);
                    if (!response.data || !response.data["Global Quote"] || Object.keys(response.data["Global Quote"]).length === 0) {
                        throw new Error(`No data returned for ${symbol}`);
                    }
                    
                    let data = response.data["Global Quote"];
                    let alertMessage = getTradeAlert(data);
                    
                    let row = `<tr>
                        <td>${symbol}</td>
                        <td>${data["05. price"] ?? 'N/A'}</td>
                        <td>${data["RSI"] ?? 'N/A'}</td>
                        <td>${data["VWAP"] ?? 'N/A'}</td>
                        <td>${data["10. change percent"] ?? 'N/A'}</td>
                        <td>${data["06. volume"] ?? 'N/A'}</td>
                        <td>${data["03. high"] ?? 'N/A'}</td>
                        <td>${data["04. low"] ?? 'N/A'}</td>
                        <td>${data["08. market cap"] ?? 'N/A'}</td>
                        <td class='alert'>${alertMessage}</td>
                        <td><button onclick="removeStock('${symbol}')">Remove</button></td>
                    </tr>`;
                    tableBody.innerHTML += row;
                } catch (error) {
                    console.error("Error fetching stock data", error);
                    errorMessage.textContent = `Error fetching stock data for ${symbol}. Please check your API key or internet connection.`;
                }
            }
        }
        
        fetchStockData();
        setInterval(fetchStockData, 60000);
    </script>
</body>
</html>
